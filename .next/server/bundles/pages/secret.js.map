{"version":3,"file":"bundles/pages/secret.js","sources":["webpack:///webpack/bootstrap 03ab8581d7c835ec30a4","webpack:///components/Header.js","webpack:///pages/secret.js","webpack:///settings.js","webpack:///static/auth.js","webpack:///static/secure-template.js","webpack:///external \"@babel/runtime/regenerator\"","webpack:///external \"isomorphic-unfetch\"","webpack:///external \"js-cookie\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"next/link\"","webpack:///external \"prop-types\"","webpack:///external \"react\"","webpack:///external \"styled-jsx/style\""],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 03ab8581d7c835ec30a4","import Link from 'next/link';\nimport PropTypes from 'prop-types';\n\nconst Header = ({ isLoggedIn }) => (\n    <div>\n        <style jsx>{`\n      ul {\n        list-style-type: none;\n        margin: 0;\n        padding: 0;\n        overflow: hidden;\n        background-color: #333;\n      }\n\n      li {\n          float: left;\n      }\n\n      li a {\n          display: block;\n          color: white;\n          text-align: center;\n          padding: 14px 16px;\n          text-decoration: none;\n      }\n\n      li a:hover {\n          background-color: #111;\n      }\n    `}</style>\n        <nav>\n            <ul>\n                <li><Link href=\"/\"><a>Home</a></Link></li>\n                <li><Link href=\"/public\"><a>Public</a></Link></li>\n                { isLoggedIn ? ( <li><Link href=\"/secret\"><a>Secret</a></Link></li> ) : ( <li><Link href=\"/login\"><a>Login</a></Link></li> ) }\n                { isLoggedIn ? ( <li><Link href=\"/logout\"><a>Logout</a></Link></li> ) : ( '' ) }\n            </ul>\n        </nav>\n        <h1>Auth0 & Next.js</h1>\n    </div>\n)\n\nHeader.propTypes = {\n    isLoggedIn: PropTypes.bool\n};\n\nexport default Header;\n\n\n// WEBPACK FOOTER //\n// components/Header.js","import PropTypes from 'prop-types';\nimport SecureTemplate from '../static/secure-template';\n\nconst Secret = ({ loggedInUser }) => (\n    <div>\n        Hi { loggedInUser.nickname }! <img src={ loggedInUser.picture } width=\"100px\" />\n        <div>\n            <style jsx>{`\n         pre {\n           width: 500px;\n           background: #ddd;\n           white-space: pre-wrap;\n         }\n       `}\n            </style>\n            <pre>{ JSON.stringify(loggedInUser, null, 2) }</pre>\n        </div>\n    </div>\n)\n\nSecret.propTypes = {\n    loggedInUser: PropTypes.object\n};\n\nexport default SecureTemplate(Secret);\n\n\n// WEBPACK FOOTER //\n// pages/secret.js","const clientID = process.env.CLIENTID || 'tvVNrCD9w2qChzBM8NrAdktDgpdDfk8b'; // your clientID\nconst domain = process.env.DOMAIN || 'doodcoin.auth0.com'; // your domain\n\nexport {\n    clientID,\n    domain\n};\n\n\n// WEBPACK FOOTER //\n// settings.js","import Cookie from 'js-cookie';\nimport jwt from 'jsonwebtoken';\nimport fetch from 'isomorphic-unfetch';\nimport * as settings from '../settings';\n\nasync function getJWK() {\n    const res = await fetch(`https://${settings.domain}/.well-known/jwks.json`);\n    const jwk = await res.json();\n    return jwk;\n}\n\nfunction saveToken(jwtToken, accessToken) {\n    Cookie.set('user', jwt.decode(jwtToken));\n    Cookie.set('jwtToken', jwtToken);\n};\n\nfunction deleteToken() {\n    Cookie.remove('user');\n    Cookie.remove('jwtToken');\n};\n\nasync function verifyToken(token) {\n    if (token) {\n        const decodedToken = jwt.decode(token, { complete: true });\n        const jwk = await getJWK();\n        let cert = jwk.keys[0].x5c[0];\n        cert = cert.match(/.{1,64}/g).join('\\n');\n        cert = `-----BEGIN CERTIFICATE-----\\n${cert}\\n-----END CERTIFICATE-----\\n`;\n        if (jwk.keys[0].kid === decodedToken.header.kid) {\n            try {\n                jwt.verify(token, cert);\n                return true;\n            } catch (error) {\n                console.error(error);\n                return false;\n            }\n        }\n    }\n}\n\nasync function getTokenForBrowser() {\n    const token = Cookie.getJSON('jwtToken');\n    const validToken = await verifyToken(token);\n    if (validToken) {\n        return Cookie.getJSON('user');\n    }\n}\n\nasync function getTokenForServer(req) {\n    if (req.headers.cookie) {\n        const jwtFromCookie = req.headers.cookie.split(';').find(c => c.trim().startsWith('jwtToken='));\n        if (!jwtFromCookie) {\n            return undefined;\n        }\n        const token = jwtFromCookie.split('=')[1];\n        const validToken = await verifyToken(token);\n        if (validToken) {\n            return jwt.decode(token);\n        } else {\n            return undefined;\n        }\n    }\n}\n\nexport {\n    saveToken,\n    deleteToken,\n    getTokenForBrowser,\n    getTokenForServer,\n    verifyToken\n};\n\n\n// WEBPACK FOOTER //\n// static/auth.js","import React from 'react';\nimport Header from '../components/Header';\nimport { getTokenForBrowser, getTokenForServer } from '../static/auth';\n\nexport default Page => class Template extends React.Component {\n    static async getInitialProps({ req }) {\n        const loggedInUser = process.browser ? await getTokenForBrowser() : await getTokenForServer(req);\n        const pageProperties = await Page.getInitialProps && await Page.getInitialProps(req);\n        return {\n            ...pageProperties,\n            loggedInUser,\n            isLoggedIn: !!loggedInUser\n        }\n    }\n\n    render() {\n        return (\n            <div>\n                <Header { ...this.props } />\n                <Page { ...this.props } />\n            </div>\n        )\n    }\n}\n\n\n// WEBPACK FOOTER //\n// static/secure-template.js","module.exports = require(\"@babel/runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@babel/runtime/regenerator\"\n// module id = @babel/runtime/regenerator\n// module chunks = 3 4 5","module.exports = require(\"isomorphic-unfetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-unfetch\"\n// module id = isomorphic-unfetch\n// module chunks = 3 4 5","module.exports = require(\"js-cookie\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-cookie\"\n// module id = js-cookie\n// module chunks = 3 4 5","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = jsonwebtoken\n// module chunks = 3 4 5","module.exports = require(\"next/link\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"next/link\"\n// module id = next/link\n// module chunks = 3 4 5","module.exports = require(\"prop-types\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"prop-types\"\n// module id = prop-types\n// module chunks = 3 4 5","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = react\n// module chunks = 3 4 5","module.exports = require(\"styled-jsx/style\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"styled-jsx/style\"\n// module id = styled-jsx/style\n// module chunks = 3 4 5"],"mappings":"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","sourceRoot":""}